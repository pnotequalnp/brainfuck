<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
 Module      : Brainfuck.Optimizer
 Description : Brainfuck Optimizations
 Copyright   : Kevin Mullins 2022
 License     : ISC
 Maintainer  : kevin@pnotequalnp.com
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Brainfuck.Optimizer</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Brainfuck.Syntax.html"><span class="hs-identifier">Brainfuck.Syntax</span></a></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">-- | Contract chains of operations like `Add` and `ShiftR` into single combined operations</span><span>
</span><span id="line-13"></span><span id="local-6989586621679123152"><span id="local-6989586621679123153"><span class="annot"><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-type">contract</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Num</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123153"><span class="hs-identifier hs-type">byte</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123153"><span class="hs-identifier hs-type">byte</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Num</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123152"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123152"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Brainfuck"><span class="hs-identifier hs-type">Brainfuck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123153"><span class="hs-identifier hs-type">byte</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123152"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Brainfuck"><span class="hs-identifier hs-type">Brainfuck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123153"><span class="hs-identifier hs-type">byte</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123152"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-14"></span><span id="contract"><span class="annot"><span class="annottext">contract :: [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var hs-var">contract</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span id="local-6989586621679123127"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123127"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123126"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123126"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Brainfuck byte addr
forall byte addr. [Brainfuck byte addr] -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123127"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123126"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679123124"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123124"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span id="local-6989586621679123122"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123122"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679123121"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123121"><span class="hs-identifier hs-var">off'</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123120"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123120"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123124"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123121"><span class="hs-identifier hs-var">off'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-var">Set</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123122"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123121"><span class="hs-identifier hs-var">off'</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123120"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span id="local-6989586621679123119"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123119"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679123118"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123118"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679123117"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123117"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679123116"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123116"><span class="hs-identifier hs-var">off'</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123115"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123115"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123118"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123116"><span class="hs-identifier hs-var">off'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-var">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123119"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">byte -&gt; byte -&gt; byte
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123117"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123118"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123115"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679123113"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123113"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679123112"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123112"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679123111"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123111"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679123110"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123110"><span class="hs-identifier hs-var">off'</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123109"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123109"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123112"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123110"><span class="hs-identifier hs-var">off'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-var">Add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123113"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">byte -&gt; byte -&gt; byte
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123111"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123112"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123109"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-type">Shift</span></a></span><span> </span><span id="local-6989586621679123107"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123107"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-type">Shift</span></a></span><span> </span><span id="local-6989586621679123106"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123106"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123105"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123105"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr -&gt; Brainfuck byte addr
forall byte addr. addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-var">Shift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123107"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; addr
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123106"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123105"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-type">Shift</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123104"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span id="local-6989586621679123103"><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123103"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123102"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123102"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123103"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Ord byte, Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#contract"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123102"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- | Replace common loop idioms with single instructions</span><span>
</span><span id="line-25"></span><span id="local-6989586621679123146"><span id="local-6989586621679123147"><span class="annot"><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-type">deloopify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Num</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123147"><span class="hs-identifier hs-type">byte</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123147"><span class="hs-identifier hs-type">byte</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Num</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123146"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123146"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Brainfuck"><span class="hs-identifier hs-type">Brainfuck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123147"><span class="hs-identifier hs-type">byte</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123146"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Brainfuck"><span class="hs-identifier hs-type">Brainfuck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123147"><span class="hs-identifier hs-type">byte</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123146"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-26"></span><span id="deloopify"><span class="annot"><span class="annottext">deloopify :: [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var hs-var">deloopify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><span class="hs-number">1</span></span><span> </span><span id="local-6989586621679123100"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123100"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123099"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123099"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-var">Set</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123100"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123099"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span id="local-6989586621679123098"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123098"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679123097"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123097"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123096"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123096"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-var">Set</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123098"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123097"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123096"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span id="local-6989586621679123095"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123095"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123094"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123094"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Brainfuck byte addr
forall byte addr. [Brainfuck byte addr] -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123095"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123094"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span id="local-6989586621679123093"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123093"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123092"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123092"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679123091"><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123091"><span class="hs-identifier hs-var">reset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679123090"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123090"><span class="hs-identifier hs-var">mults</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
-&gt; Maybe (Brainfuck byte addr, [Brainfuck byte addr])
</span><a href="#local-6989586621679123089"><span class="hs-identifier hs-var">multLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123093"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123090"><span class="hs-identifier hs-var">mults</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123091"><span class="hs-identifier hs-var">reset</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123092"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span id="local-6989586621679123088"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123088"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123087"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123087"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123088"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123086"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-34"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Brainfuck byte addr
forall byte addr. [Brainfuck byte addr] -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123088"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123087"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-35"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Brainfuck byte addr
forall byte addr. [Brainfuck byte addr] -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123086"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123087"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>      </span><span id="local-6989586621679123086"><span class="annot"><span class="annottext">body' :: [Brainfuck byte addr]
</span><a href="#local-6989586621679123086"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123088"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679123085"><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123085"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123084"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123084"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123085"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall byte addr.
(Num byte, Eq byte, Num addr, Eq addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#deloopify"><span class="hs-identifier hs-var">deloopify</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123084"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>    </span><span id="local-6989586621679123089"><span class="annot"><span class="annottext">multLoop :: [Brainfuck byte addr]
-&gt; Maybe (Brainfuck byte addr, [Brainfuck byte addr])
</span><a href="#local-6989586621679123089"><span class="hs-identifier hs-var hs-var">multLoop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-41"></span><span>      </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679123083"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123083"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679123082"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123082"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123081"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123081"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123082"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Brainfuck byte addr] -&gt; [Brainfuck byte addr])
-&gt; (Brainfuck byte addr, [Brainfuck byte addr])
-&gt; (Brainfuck byte addr, [Brainfuck byte addr])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Mul"><span class="hs-identifier hs-var">Mul</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123083"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123082"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Brainfuck byte addr, [Brainfuck byte addr])
 -&gt; (Brainfuck byte addr, [Brainfuck byte addr]))
-&gt; Maybe (Brainfuck byte addr, [Brainfuck byte addr])
-&gt; Maybe (Brainfuck byte addr, [Brainfuck byte addr])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
-&gt; Maybe (Brainfuck byte addr, [Brainfuck byte addr])
</span><a href="#local-6989586621679123089"><span class="hs-identifier hs-var">multLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123081"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-42"></span><span>      </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Dec"><span class="hs-identifier hs-var">Dec</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123076"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123076"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-var">Set</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">addr
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Brainfuck byte addr]
 -&gt; (Brainfuck byte addr, [Brainfuck byte addr]))
-&gt; Maybe [Brainfuck byte addr]
-&gt; Maybe (Brainfuck byte addr, [Brainfuck byte addr])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Maybe [Brainfuck byte addr]
forall byte. [Brainfuck byte addr] -&gt; Maybe [Brainfuck byte addr]
</span><a href="#local-6989586621679123075"><span class="hs-identifier hs-var">multLoop'</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123076"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-43"></span><span>      </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Brainfuck byte addr, [Brainfuck byte addr])
forall a. Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span id="local-6989586621679123075"><span class="annot"><span class="annottext">multLoop' :: [Brainfuck byte addr] -&gt; Maybe [Brainfuck byte addr]
</span><a href="#local-6989586621679123075"><span class="hs-identifier hs-var hs-var">multLoop'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-45"></span><span>      </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679123074"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123074"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679123073"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123073"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123072"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123072"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123073"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Mul"><span class="hs-identifier hs-var">Mul</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123074"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123073"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Brainfuck byte addr] -&gt; [Brainfuck byte addr])
-&gt; Maybe [Brainfuck byte addr] -&gt; Maybe [Brainfuck byte addr]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Maybe [Brainfuck byte addr]
</span><a href="#local-6989586621679123075"><span class="hs-identifier hs-var">multLoop'</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123072"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Maybe [Brainfuck byte addr]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span>      </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [Brainfuck byte addr]
forall a. Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Avoid redundant pointer manipulation by doing operations at an offset from the pointer</span><span>
</span><span id="line-50"></span><span id="local-6989586621679123132"><span id="local-6989586621679123133"><span class="annot"><a href="Brainfuck.Optimizer.html#offsetInstructions"><span class="hs-identifier hs-type">offsetInstructions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Num</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123133"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123133"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Brainfuck"><span class="hs-identifier hs-type">Brainfuck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123132"><span class="hs-identifier hs-type">byte</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123133"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Brainfuck.Syntax.html#Brainfuck"><span class="hs-identifier hs-type">Brainfuck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123132"><span class="hs-identifier hs-type">byte</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679123133"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-51"></span><span id="offsetInstructions"><span class="annot"><span class="annottext">offsetInstructions :: [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#offsetInstructions"><span class="hs-identifier hs-var hs-var">offsetInstructions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-type">Loop</span></a></span><span> </span><span id="local-6989586621679123070"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123070"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123069"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123069"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; Brainfuck byte addr
forall byte addr. [Brainfuck byte addr] -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall addr byte.
(Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#offsetInstructions"><span class="hs-identifier hs-var">offsetInstructions</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123070"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall addr byte.
(Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#offsetInstructions"><span class="hs-identifier hs-var">offsetInstructions</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123069"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-type">Shift</span></a></span><span> </span><span id="local-6989586621679123068"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123068"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123067"><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123067"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-type">Shift</span></a></span><span> </span><span id="local-6989586621679123066"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123066"><span class="hs-identifier hs-var">off'</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123065"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123065"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679123064"><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123064"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">addr -&gt; Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
forall addr byte.
Num addr =&gt;
addr -&gt; Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
</span><a href="#local-6989586621679123063"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123068"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123067"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123064"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall addr byte.
(Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#offsetInstructions"><span class="hs-identifier hs-var">offsetInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr -&gt; Brainfuck byte addr
forall byte addr. addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Shift"><span class="hs-identifier hs-var">Shift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123068"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; addr
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123066"><span class="hs-identifier hs-var">off'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123065"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span id="local-6989586621679123062"><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123062"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679123061"><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123061"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><a href="#local-6989586621679123062"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr
-&gt; [Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
forall addr byte.
(Num addr, Ord addr) =&gt;
[Brainfuck byte addr] -&gt; [Brainfuck byte addr]
</span><a href="Brainfuck.Optimizer.html#offsetInstructions"><span class="hs-identifier hs-var">offsetInstructions</span></a></span><span> </span><span class="annot"><span class="annottext">[Brainfuck byte addr]
</span><a href="#local-6989586621679123061"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621679123063"><span class="annot"><span class="annottext">offset :: addr -&gt; Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
</span><a href="#local-6989586621679123063"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679123060"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123060"><span class="hs-identifier hs-var">shift</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679123059"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123059"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679123058"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123058"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Add"><span class="hs-identifier hs-var">Add</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123059"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123060"><span class="hs-identifier hs-var">shift</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; addr
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123058"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span id="local-6989586621679123057"><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123057"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679123056"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123056"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">byte -&gt; addr -&gt; Brainfuck byte addr
forall byte addr. byte -&gt; addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Set"><span class="hs-identifier hs-var">Set</span></a></span><span> </span><span class="annot"><span class="annottext">byte
</span><a href="#local-6989586621679123057"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123060"><span class="hs-identifier hs-var">shift</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; addr
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123056"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><a href="Brainfuck.Syntax.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span id="local-6989586621679123054"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123054"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr -&gt; Brainfuck byte addr
forall byte addr. addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123060"><span class="hs-identifier hs-var">shift</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; addr
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123054"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>      </span><span class="annot"><a href="Brainfuck.Syntax.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span id="local-6989586621679123052"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123052"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Brainfuck byte addr -&gt; Maybe (Brainfuck byte addr)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr -&gt; Brainfuck byte addr
forall byte addr. addr -&gt; Brainfuck byte addr
</span><a href="Brainfuck.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123060"><span class="hs-identifier hs-var">shift</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; addr -&gt; addr
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679123052"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><span class="annottext">Brainfuck byte addr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Brainfuck byte addr)
forall a. Maybe a
</span><a href="../file:///nix/store/v7szadshw96crn5859pd08h4qz152gs6-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-64"></span></pre></body></html>